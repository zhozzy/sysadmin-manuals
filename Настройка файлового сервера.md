## Настройка файлового хранилища Samba с авторизацией. Ubuntu 18.04

Научимся устанавливать и настраивать файловый сервер **Samba**. Это ПО известно тем, что для доступа к файлам использует протокол **SMB** - протокол работы с файловым серверам от Microsoft. На самом деле сейчас Samba умеет не только работать файловым сервером, но еще и контроллером доменов, совместимым с Microsoft Active Directory с немного урезанными групповыми политиками.

Настраивать будем на **Ubuntu 18.04 LTS**. Руководство подойдет для организации численностью до 50 человек.

Обновим базу пакетов:
```sudo apt-get update ```

>На боевом сервере лучше сделать бекап перед тем как обновляешь что-либо

Установка самого сервера Samba призводится командой:
```sudo apt-get install samba ```

Идем в папку с конфигурационными файлами Samba. Там будет лежать демонстрационная конфигурация (*smb.conf*).

```cd /etc/samba ```

В данной руководстве будем писать свою конфигурацию, поэтому дефолтную можем сохранить и почитать на досуге.
Создаем свой конфигурационный файл и файл содержащий логины и пароли (в зашифрованном виде):

```sudo touch smb.conf```<br>
```sudo touch smbusers```

Создадим папку, которую будем расшаривать в сеть:
```sudo mkdir /opt/FirstTestShare ```<br>
```sudo chmod 777 /opt/FirstTestShare```

Открываем **smb.conf** и приступаем к редактированию
Конфигурация сервера состоит из нескольких секций. Основная секция **[global]** и каждая шара будет настроена отдельной секцией, также обозначенной квадратными скобками. К примеру **[share1]**, **[share2]**, **[Music]**, **[Video]** и т.д.

Сначала **[global]**

***[global]***
*### Identification ###*
*server string = %h server (Samba, Ubuntu)*   
*workgroup = WORKGROUP* # Идентификатор в сетевом окружении  

*### Authentification ###*
*server role = standalone server*  # Роль - обычный файловый сервер.  
*security = user* # Тип авторизации. Сущ. 3 типа:user, domain, share.    
*passdb backend = smbpasswd* # Тип БД пользователей  
*smb passwd file = /etc/samba/smbusers* # Файл БД пользователей  
*encrypt passwords = yes* #  Разрешаем шифрованние паролей  
*map to guest = bad user* #  Запрещаем гостевой вход  

*### Logs ###*  
*log file = /var/log/samba/log.%m* # Указываем файл, в который будут писаться логи сервиса.  
*syslog = 3* # Уровень логирования. Чем выше, тем подробнее логи. Не злоупотреблять.

***[FirstTestShare]***
*comment = Our Test Share* # Всплывающая подсказка, при наведении на  сетевую папку.  
*path = /opt/FirstTestShare* # Путь к расшариваемой папке.  
*browseable = yes* # Видимость папки. Чтобы сделать скрытой поставбте no.  
*writeable = yes* # Разрешаем запись в нашу папку  
*create mask = 0775* # Определяем права, которые будут выдаваться файлам, залитым на шару.  
*directory mask = 0775*# Права для директорий.  

После чего сохраняем файл и перезапускаем сервер Samba командой:    
```sudo service smbd restart ```    
Также добавим его в автозагрузку, для того, чтобы каждый раз его не включать:  
```sudo systemctl enable smbd```    
 
 Теперь в сетевом окружении можем видеть нашу расшаренную папку. Если этого не произошло необходимо:
 + Включить сетевое обнаружение и общий доступ к папкам на Windows.  
 + Включить протокол smb1 в компонентах Windows(для старых машин).
 + Попробовать ввести в стандартном проводнике Windows в ручную ip сервера(В моем случае виртуалка в режиме сетевого моста):  
 ```\\ip вашего сервера```
 


